version: 2
models:
  - name: stg_segment_profiles__tracks
    columns:
      - name: utm_source
        description: ''
        config:
          meta: {}
          tags: []
      - name: utm_medium
        description: ''
        config:
          meta: {}
          tags: []
      - name: utm_campaign
        description: ''
        config:
          meta: {}
          tags: []
      - name: utm_term
        description: ''
        config:
          meta: {}
          tags: []
      - name: utm_content
        description: ''
        config:
          meta: {}
          tags: []
      - name: ip
        description: ''
        config:
          meta: {}
          tags: []
      - name: library_name
        description: ''
        config:
          meta: {}
          tags: []
      - name: context_library_version
        description: ''
        config:
          meta: {}
          tags: []
      - name: context_locale
        description: ''
        config:
          meta: {}
          tags: []
      - name: page_url_path
        description: ''
        config:
          meta: {}
          tags: []
      - name: referrer
        description: ''
        config:
          meta: {}
          tags: []
      - name: page_url_query
        description: ''
        config:
          meta: {}
          tags: []
      - name: context_page_title
        description: ''
        config:
          meta: {}
          tags: []
      - name: page_url
        description: ''
        config:
          meta: {}
          tags: []
      - name: context_protocols_source_id
        description: ''
        config:
          meta: {}
          tags: []
      - name: context_protocols_violations
        description: ''
        config:
          meta: {}
          tags: []
      - name: context_timezone
        description: ''
        config:
          meta: {}
          tags: []
      - name: user_agent
        description: ''
        config:
          meta: {}
          tags: []
      - name: context_user_agent_data_brands
        description: ''
        config:
          meta: {}
          tags: []
      - name: context_user_agent_data_mobile
        description: ''
        config:
          meta: {}
          tags: []
      - name: context_user_agent_data_platform
        description: ''
        config:
          meta: {}
          tags: []
      - name: event_name
        description: ''
        config:
          meta: {}
          tags: []
      - name: event_source_id
        description: ''
        config:
          meta: {}
          tags: []
      - name: source_name
        description: ''
        config:
          meta: {}
          tags: []
      - name: event_source_slug
        description: ''
        config:
          meta: {}
          tags: []
      - name: event_text
        description: ''
        config:
          meta: {}
          tags: []
      - name: id
        description: ''
        config:
          meta: {}
          tags: []
      - name: loaded_at
        description: ''
        config:
          meta: {}
          tags: []
      - name: original_timestamp
        description: ''
        config:
          meta: {}
          tags: []
      - name: received_at_tstamp
        description: ''
        config:
          meta: {}
          tags: []
      - name: segment_id
        description: ''
        config:
          meta: {}
          tags: []
      - name: sent_at
        description: ''
        config:
          meta: {}
          tags: []
      - name: tstamp
        description: ''
        config:
          meta: {}
          tags: []
      - name: user_id
        description: ''
        config:
          meta: {}
          tags: []
      - name: uuid_ts
        description: ''
        config:
          meta: {}
          tags: []
      - name: anonymous_id
        description: ''
        config:
          meta: {}
          tags: []
      - name: context_event_transformed
        description: ''
        config:
          meta: {}
          tags: []
      - name: context_transforms_beta
        description: ''
        config:
          meta: {}
          tags: []
      - name: page_url_host
        description: ''
        config:
          meta: {}
          tags: []
      - name: registered_domain
        description: ''
        config:
          meta: {}
          tags: []
      - name: referrer_host
        description: ''
        config:
          meta: {}
          tags: []
unit_tests:
    - name: referrer_transformation_google_tracks
      model: stg_segment_profiles__tracks
      description: 'Unit test: www.google.com?search should be transformed to google.com in referrer_host.'
      given:
        - input: source("raw_segment_profiles", "tracks_view")
          rows:
            - context_page_referrer: www.google.com?search
            - context_page_referrer: www.bing.com?search
      expect:
        rows:
          - referrer_host: google.com
          - referrer_host: bing.com
