version: 2
models:
  - name: fct_loans
    description: Fact table for loans.
    columns:
      - name: id
        data_type: STRING
        tests:
          - not_null
          - unique
        config:
          meta: {}
          tags: []
        description: Transaction hash as unique identifier for the loan record.
      - name: fk__dim1_users
        data_type: STRING
        tests:
          - not_null
          - relationships:
              field: canonical_segment_id
              to: ref('dim1_users')
        config:
          meta: {}
          tags: []
        description: Foreign key to Users dimension (Canonical Segment ID). Links this loan record to the unified user profile.
      - name: collateral_usd_value
        data_type: FLOAT64
        config:
          meta: {}
          tags: []
        description: USD value of the collateral backing the loan.
      - name: principal
        data_type: FLOAT64
        config:
          meta: {}
          tags: []
        description: Debt principal after the operation.
      - name: interest
        data_type: FLOAT64
        config:
          meta: {}
          tags: []
        description: Accrued interest after the operation.
      - name: collateral
        data_type: FLOAT64
        config:
          meta: {}
          tags: []
        description: Collateral locked after the operation.
      - name: stake
        data_type: FLOAT64
        config:
          meta: {}
          tags: []
        description: Borrower stake after the operation.
      - name: loan_count
        data_type: INT64
        config:
          meta: {}
          tags: []
        description: Total number of loans represented in this record.
      - name: record_date
        data_type: DATE
        config:
          meta: {}
          tags: []
        description: Date of the record, used for time-based analysis.
      - name: new_loan_count
        data_type: INT64
        config:
          meta: {}
          tags: []
        description: Count of newly opened loans on the given record date.
      - name: adjusted_loan_count
        data_type: INT64
        config:
          meta: {}
          tags: []
        description: Count of existing loans that were adjusted (e.g., collateral or terms changed).
      - name: closed_loan_count
        data_type: INT64
        config:
          meta: {}
          tags: []
        description: Count of loans that were fully closed or repaid on the given record date.
